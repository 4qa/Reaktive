buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath Deps.kotlinx.compatibility
    }
}

apply plugin: kotlinx.validation.BinaryCompatibilityValidatorPlugin

apiValidation {
    ignoredProjects += [
            'benchmarks',
            'jmh',
            'sample-android-app',
            'sample-mpp-module',
            'sample-js-browser-app',
            'sample-linuxx64-app',
            'sample-ios-app',
            'sample-macos-app'
    ]
}

// Remove direct dependency of check on apiCheck, we will check in separate run
// https://github.com/Kotlin/binary-compatibility-validator/blob/master/src/main/kotlin/BinaryCompatibilityValidatorPlugin.kt#L146

subprojects { project ->
    if (apiValidation.ignoredProjects.contains(project.name)) return
    project.afterEvaluate {
        def apiCheck = project.tasks.named('apiCheck')
        project.tasks.named('check') { it.dependsOn.remove(apiCheck) }
    }
}
